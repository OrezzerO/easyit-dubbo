# SUMMARY

Dubbo 的启动会涉及到各个组件, 每个组件具体做的事情可以在 [组件详解](组件详解.md) 中了解到. 本篇文章会通过一些线索,
将分散在不同组件中的行为组织起来介绍.

# 启动服务

通过简单几行代码, 我们就能启动一个 Dubbo 服务:

1. [创建 DubboBootstrap 实例](../dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java#L48)
2. [注入信息](../dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java#L49):
   启动服务端的时候,
   会将一些信息注入到 DubboBootstrap 中. 包括注册中心地址, ServiceConfig 等.
3. [调用start方法启动Dubbo服务](../dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java#L53). -> [详见 Deployer.md](Deployer.md#L39)

# 以服务为线索分析启动

Dubbo 服务端需要一个具体的对象来处理请求, 在我们这个例子中, 我们会以这个对象的生命周期为线索, 解读 Dubbo 的启动过程.

1. [创建对象](../dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java#L46)
2. [将对象存储到 ServiceConfig](../dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java#L46)
3. [将 serviceConfig 注册到 DubboBootstrap 中](../dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java#L52)
4. 上一步的最终结果就是, serviceConfig
   被[注册到 ModuleModel 的 ConfigManager 中](../dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/bootstrap/DubboBootstrap.java#L543)
5. 在 ModuleMode start 的过程中, 会将 ConfigManager 中 service 取出,
   并 [调用其的 ServiceConfig 的 export() 方法](../dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/deploy/DefaultModuleDeployer.java#L350)
6. 在初始化 ServiceConfig
   的时候, [将实例注入到 serviceMetadata](../dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/ServiceConfig.java#L216)
7. 在 ServiceConfig 的 doExportUrl 方法中,
   会[把实例包装成一个 Invoker](../dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/ServiceConfig.java#L713) (
   代理模式)
8. [通过 protocolSPI (Dubbo protocol) 将包装过后的 Invoker 暴露](../dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/ServiceConfig.java#L717)
9. [首先会将 Invoker 在本地 export ](../dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/ServiceConfig.java#L619),
   此时,用的是 InjvmProtocol,会将由Invoker生成的
   Exporter,[保存到 exporterMap 中](../dubbo-rpc/dubbo-rpc-injvm/src/main/java/org/apache/dubbo/rpc/protocol/injvm/InjvmProtocol.java#L86)
10. [export 到 Remote](../dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/ServiceConfig.java#L636):
    分为[RegistryProtocol](../dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/integration/RegistryProtocol.java#L141)
    和 [DubboProtocol](../dubbo-rpc/dubbo-rpc-dubbo/src/main/java/org/apache/dubbo/rpc/protocol/dubbo/DubboProtocol.java#L309)
11. DubboProtocol export 的时候,
    也会[将含有 Invoker 的 Exporter 存放到 exportMap 中](../dubbo-rpc/dubbo-rpc-dubbo/src/main/java/org/apache/dubbo/rpc/protocol/dubbo/DubboProtocol.java#L314)
12. 服务端(Dubbo Protocol)
    接收到请求的时候,调用[getInvoker](../dubbo-rpc/dubbo-rpc-dubbo/src/main/java/org/apache/dubbo/rpc/protocol/dubbo/DubboProtocol.java#L126), [通过 serviceKey 从 exporterMap 获取 Exporter](../dubbo-rpc/dubbo-rpc-dubbo/src/main/java/org/apache/dubbo/rpc/protocol/dubbo/DubboProtocol.java#L288)
13. [调用 invoker ,实际上调用到实例](../dubbo-rpc/dubbo-rpc-dubbo/src/main/java/org/apache/dubbo/rpc/protocol/dubbo/DubboProtocol.java#L156)




# 其他:
注册到注册中心: [registry.register(registeredProviderUrl);](../dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/integration/RegistryProtocol.java#L212)







